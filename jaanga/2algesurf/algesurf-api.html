<!doctype html>
<html lang='en'>
<head>
<title></title>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0'>
<link type='text/css' rel='stylesheet' href='../page.css' />
</head>
<body>

<script src='http://mrdoob.github.com/three.js/build/three.min.js'></script>
<script src='http://mrdoob.github.com/three.js/examples/js/controls/TrackballControls.js'></script>
<script src='http://mrdoob.github.com/three.js/examples/js/libs/stats.min.js'></script>
<script src='http://mrdoob.github.com/three.js/examples/js/Detector.js'></script>
<!--
<script src='../../three.js/build/three.min.js'></script>
<script src='../../three.js/examples/js/controls/TrackballControls.js'></script>
<script src='../../three.js/examples/js/Detector.js'></script>
<script src='../../three.js/examples/js/libs/stats.min.js'></script>
-->
<script src='parser.js'></script>
<script src='MarchingCubesData.js'></script>
<script src='generateGeometry.js'></script>
<script type='text/javascript'>
	if ( ! Detector.webgl ) { Detector.addGetWebGLMessage(); }

	var renderer, scene, camera, controls;
	var geometry, material, mesh;

	init();
	animate();

	var spin = 2;
	
	function init() {
		document.body.style.cssText = 'margin: 0; overflow: hidden; padding: 0;';
		
		var sheet = document.createElement('style')
		sheet.innerHTML = 'input[type=range] { -webkit-appearance: none; background-color: silver; height:20px; opacity: 0.5; width: 80px;}' +
			'input[type="range"]::-webkit-slider-thumb {-webkit-appearance: none; background-color: #666; opacity: 0.5; width: 10px; height: 26px; }' ;
		document.body.appendChild(sheet);		

		var args = document.location.search.substring(1).split('&');
		var vars = {};
		for ( var i = 0, arg, kvp; i < args.length; i++) {
			arg = unescape(args[i]);
			if (arg.indexOf('=') == -1) {
				vars[arg.trim()] = true;
			} else {
				kvp = arg.split('=');
				vars[kvp[0].trim()] = kvp[1].trim();
			}
		}
// console.log('api: ', vars);    
		var height = vars['height'] !== undefined ? vars['height'] : window.innerHeight;
		var width = vars['width'] !== undefined ? vars['width'] : window.innerWidth;

		renderer = new THREE.WebGLRenderer( { antialias: true } );
		renderer.setSize( width, height );
		document.body.appendChild( renderer.domElement );

		scene = new THREE.Scene();

		camera = new THREE.PerspectiveCamera( 40, width / height, 1, 500 );
		camera.position.set( 20, 20, -20 );
		controls = new THREE.TrackballControls( camera, renderer.domElement );

		var eqn = vars['equation'] !== undefined ? vars['equation'] : 'x^2 + y^2 - z^2 - 70';
		var html = vars['html'] !== undefined ? vars['html'] : vars['equation'] ; 
		var min = vars['min'] !== undefined ? parseFloat( vars['min'] ) : -10;
		var max = vars['max'] !== undefined ? parseFloat( vars['max'] ) : 10;
		var scale = vars['scale'] !== undefined ? parseFloat( vars['scale'] ) : 1;	
		var title = vars['title'] !== undefined ? vars['title'] : 'Surface' ; 
	
		var jsFunction = Parser.parse(eqn).toJSFunction( ['x','y','z'] );
		generateGeometry( jsFunction, min, max );
		material =  new THREE.MeshNormalMaterial( { side: THREE.DoubleSide, opacity: 0.9, transparent: true, }) ;
		mesh = new THREE.Mesh( geometry, material );
		mesh.scale.multiplyScalar( scale );
		scene.add(mesh);

		info = document.createElement( 'div' ); 	
		document.body.appendChild( info ); 	
		info.style.cssText = 'position: fixed; top: 20px; left: 20px;'; 	
		info.innerHTML = '<h1>' + title + '</h1><h2>equation: ' + html + '<br>min: ' + min + '<br>max: ' + max + '<br>scale: ' + scale + '</h2>'; 
		info.innerHTML += '<a href="#" title="View the full API call..." target="_blank">full screen</a>';
		info.innerHTML += '<br><a href="#" onclick="camera.position.set( 20, 20, -20 ); controls = new THREE.TrackballControls( camera, renderer.domElement );" >camera reset</a>';
		info.innerHTML += '<br>spin<br><input type="range" name="spin" min="0" max="5" onchange="spin=this.value;" step="0.5" value="2" >';
	}

	function animate() {
		requestAnimationFrame( animate );
		controls.update();
		scene.children[0].rotation.x = Date.now() * 0.00025 * spin;
		scene.children[0].rotation.y = Date.now() * 0.0005 * spin;
		renderer.render( scene, camera );
	}
</script>
</body>
</html>